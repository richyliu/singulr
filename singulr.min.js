/*! Singulr v0.0.1r19 | (c) Richard Liu | MIT License */

(function(d,k){function p(){function b(a){var b=this.getAttribute("href"),c=a.target;1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||k.location.protocol!==c.protocol||k.location.hostname!==c.hostname||-1<c.href.indexOf("#")&&c.href.replace(/#.*/,"")==k.location.href.replace(/#.*/,"")||k.location.pathname+k.location.hash+k.location.search===c.pathname+c.hash+c.search||(console.log("click!"),u(b),a.preventDefault())}for(var c=d.getElementsByTagName("a"),a=0;a<c.length;a++)c[a].removeEventListener("click",
b);c=d.getElementsByTagName("a");for(a=0;a<c.length;a++)c[a].addEventListener("click",b);null===k.onpopstate&&(k.onpopstate=function(a){q(d.location.href.substr(d.location.href.lastIndexOf("/")+1))})}function A(){function b(a){"N"==a.animationName&&(console.log("node inserted!"),console.log(a),setTimeout(p(),20))}d.removeEventListener("animationstart",b,!1);d.removeEventListener("MSAnimationStart",b,!1);d.removeEventListener("webkitAnimationStart",b,!1);d.addEventListener("animationstart",b,!1);d.addEventListener("MSAnimationStart",
b,!1);d.addEventListener("webkitAnimationStart",b,!1);var c=d.createElement("style");c.innerHTML="@-webkit-keyframes fLhpiHgvMd{}@-moz-keyframes fLhpiHgvMd{}@-o-keyframes fLhpiHgvMd{}@keyframes fLhpiHgvMd{}a{-webkit-animation-name:fLhpiHgvMd;-moz-animation-name:fLhpiHgvMd;-o-animation-name:fLhpiHgvMd;animation-name:fLhpiHgvMd}";d.getElementsByTagName("head")[0].appendChild(c)}function u(b){console.log("load page external: "+b);k.history.pushState({},"",b);q(b)}function q(b){w=b;x(g.CONTENT_ID,w,function(c){if(l!==
[]){for(var a=0;a<l.length;a++)m(l[a]);y();l=[]}if(!c||"string"!==typeof c)throw"Invalid page";var b=d.implementation.createHTMLDocument();-1<c.search("<html>")?b.body.parentElement.innerHTML=c:b.body.parentElement.innerHTML="<html>"+c+"</html>";var e,a=b.getElementsByTagName("title")[0];null!==a&&""!==a&&(d.title=a.innerHTML);if(b.getElementsByTagName("style")!==[])for(var h=b.getElementsByTagName("style"),a=0;a<h.length;a++)e=h[a].innerHTML,""!==e&&(c=d.createElement("style"),c.innerHTML=e,d.getElementsByTagName("head")[0].appendChild(c),
l.push(c)),m(h[a]);if(b.getElementsByTagName("link")!==[])for(h=b.getElementsByTagName("link"),a=0;a<h.length;a++)"stylesheet"===h[a].getAttribute("rel")&&(e=h[a].getAttribute("href"),c=d.createElement("link"),c.rel="stylesheet",c.type="text/css",c.href=e,d.getElementsByTagName("head")[0].appendChild(c),l.push(c)),m(h[a]);var h=[],f=b.getElementsByTagName("head")[0].getElementsByTagName("script");if(f!==[])for(a=0;a<f.length;a++)"singulr-ignore"!==f[a].getAttribute("class")&&(e=f[a].getAttribute("src"),
c=f[a].innerHTML,null!==e?h.push(["src",e]):""!==c&&h.push(["code",c]),m(f[a]));r(h);f=b.getElementsByTagName("body")[0].getElementsByTagName("script");if(f!==[])for(a=0;a<f.length;a++)"singulr-ignore"!==f[a].getAttribute("class")&&(e=f[a].getAttribute("src"),c=f[a].innerHTML,null!==e?n.push(["src",e]):""!==c&&n.push(["code",c]),m(f[a]));c=g.analyticNodes;if(0<c.length)for(a=0;a<c.length;a++)d.getElementsByTagName("body")[0].appendChild(c[a]),l.push(c[a]);y();return b.documentElement.getElementsByTagName("body")[0].innerHTML})}
function x(b,c,a){function k(){if(200===e.status){var c=a(e.responseText);if("string"===typeof c)d.getElementById(b).innerHTML=c;else if(void 0===c)d.getElementById(b).innerHTML=e.responseText;else throw Error("Invalid callback return!");}else if(404===e.status)q(g.PAGE_404);else throw alert("Error "+e.status+": "+e.statusText),Error("Error status: "+e.status);}var e=new XMLHttpRequest;e.open("GET",c,!0);e.onload=b===g.CONTENT_ID?function(){k();g.onDocumentLoaded();r(n,function(){n=[];g.onPageLoaded();
p()})}:function(){k();r(n,function(){n=[];p()})};e.send()}function B(b,c){var a=d.createElement("script");a.async=!1;a.onload=a.onreadystatechange=function(){c();a.parentNode.removeChild(a)};a.src=b;d.getElementsByTagName("body")[0].appendChild(a)}function r(b,c){0<b.length?v(0,b,c||function(){}):"function"===typeof c&&c()}function v(b,c,a){"src"===c[b][0]?B(c[b][1],function(){void 0!==c[b+1]?v(b+1,c,a):a()}):"code"===c[b][0]&&(k.eval.call(k,c[b][1]),void 0!==c[b+1]?v(b+1,c,a):a())}function m(b){if(void 0===
b||null===b)console.warn("No node provided!");else{if(null===b.parentNode)throw Error("Node has been already removed");t.push(b)}}function y(){for(var b=0;b<t.length;b++){var c=t[b];c.parentNode.removeChild(c)}t=[]}function C(b,c){function a(){!d&&c&&(d=!0,c.call(b))}var d;b.addEventListener&&b.addEventListener("load",a);b.attachEvent&&b.attachEvent("onload",a);if("isApplicationInstalled"in navigator&&"onloadcssdefined"in b)b.onloadcssdefined(a)}var w="",l=[],t=[],n=[],z=!1,g={onDocumentLoaded:function(){},
onPageLoaded:function(){},onDependenciesLoaded:function(){},analyticNodes:[],INDEX_PAGE:"/index.html",INDEX_PATH:"/",HOME_PAGE:"home.html",BASE_PAGE:"base.html",PAGE_404:"404.html",PAGE_ID:"page",CONTENT_ID:"content",dependencies:{javascript:[],css:[]}};k.Singulr={init:function(b){function c(){z||(z=!0,g.onDependenciesLoaded(),x(g.PAGE_ID,g.BASE_PAGE,function(){var a=k.location.href.substr(k.location.href.lastIndexOf("/")+1),a=a.substr(a.indexOf("?")+1),a=decodeURIComponent(a);k.history.replaceState({},
"",a);console.log("curFullPageUrl: "+a);0<a.length&&a!==g.INDEX_PAGE?u(a):q(g.HOME_PAGE)}))}if(void 0!==b)for(var a in b)b.hasOwnProperty(a)&&void 0!==g[a]&&(g[a]=b[a]);A();var d=!1,e=!0;a=[];for(b=0;b<g.dependencies.javascript.length;b++)a.push(["src",g.dependencies.javascript[b]]);r(a,function(){d=!0;e&&c()});a=g.dependencies.css;var h=[],f;for(b=0;b<a.length;b++)f=D(a[b]),C(f,function(){h[a]=!0;for(var a=0;a<h.length;a++)if(!1===h[a])return;e=!0;d&&c()})},getPage:function(){var b=k.location,c=
b.pathname+b.hash+b.search;return b.pathname===g.INDEX_PAGE||b.pathname===g.INDEX_PATH?g.INDEX_PATH+g.HOME_PAGE:c},loadPage:u,bindEventHandlers:p};var D=function(b,c,a){function d(a){if(h.body)return a();setTimeout(function(){d(a)})}function e(){f.addEventListener&&f.removeEventListener("load",e);f.media=a||"all"}var h=k.document,f=h.createElement("link"),g;if(c)g=c;else{var l=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=l[l.length-1]}var n=h.styleSheets;f.rel="stylesheet";f.href=b;f.media=
"only x";d(function(){g.parentNode.insertBefore(f,c?g:g.nextSibling)});var m=function(a){for(var b=f.href,c=n.length;c--;)if(n[c].href===b)return a();setTimeout(function(){m(a)})};f.addEventListener&&f.addEventListener("load",e);f.onloadcssdefined=m;m(e);return f}})(document,window);