/*! Singulr v0.0.1r18 | (c) Richard Liu | MIT License */

(function(d,k){function u(){function a(b){var a=this.getAttribute("href"),c=b.target;1<b.which||b.metaKey||b.ctrlKey||b.shiftKey||b.altKey||k.location.protocol!==c.protocol||k.location.hostname!==c.hostname||-1<c.href.indexOf("#")&&c.href.replace(/#.*/,"")==k.location.href.replace(/#.*/,"")||k.location.pathname+k.location.hash+k.location.search===c.pathname+c.hash+c.search||(console.log("click!"),v(a),b.preventDefault())}function c(b){q(d.location.href.substr(d.location.href.lastIndexOf("/")+1))}
for(var b=d.getElementsByTagName("a"),e=0;e<b.length;e++)b[e].removeEventListener("click",a);b=d.getElementsByTagName("a");for(e=0;e<b.length;e++)b[e].addEventListener("click",a);null===k.onpopstate&&(k.onpopstate=c)}function B(){function a(b){"N"==b.animationName&&(console.log("node inserted!"),console.log(b),setTimeout(u(),20))}d.removeEventListener("animationstart",a,!1);d.removeEventListener("MSAnimationStart",a,!1);d.removeEventListener("webkitAnimationStart",a,!1);d.addEventListener("animationstart",
a,!1);d.addEventListener("MSAnimationStart",a,!1);d.addEventListener("webkitAnimationStart",a,!1);var c=d.createElement("style");c.innerHTML="@-webkit-keyframes fLhpiHgvMd{}@-moz-keyframes fLhpiHgvMd{}@-o-keyframes fLhpiHgvMd{}@keyframes fLhpiHgvMd{}a{-webkit-animation-name:fLhpiHgvMd;-moz-animation-name:fLhpiHgvMd;-o-animation-name:fLhpiHgvMd;animation-name:fLhpiHgvMd}";d.getElementsByTagName("head")[0].appendChild(c)}function v(a){console.log("load page external: "+a);k.history.pushState({},"",
a);q(a)}function q(a){x=a;y(h.CONTENT_ID,x,function(a){if(m!==[]){for(var b=0;b<m.length;b++)n(m[b]);z();m=[]}if(!a||"string"!==typeof a)throw"Invalid page";var e=d.implementation.createHTMLDocument();-1<a.search("<html>")?e.body.parentElement.innerHTML=a:e.body.parentElement.innerHTML="<html>"+a+"</html>";var f,b=e.getElementsByTagName("title")[0];null!==b&&""!==b&&(d.title=b.innerHTML);if(e.getElementsByTagName("style")!==[])for(var l=e.getElementsByTagName("style"),b=0;b<l.length;b++)f=l[b].innerHTML,
""!==f&&(a=d.createElement("style"),a.innerHTML=f,d.getElementsByTagName("head")[0].appendChild(a),m.push(a)),n(l[b]);if(e.getElementsByTagName("link")!==[])for(l=e.getElementsByTagName("link"),b=0;b<l.length;b++)"stylesheet"===l[b].getAttribute("rel")&&(f=l[b].getAttribute("href"),a=d.createElement("link"),a.rel="stylesheet",a.type="text/css",a.href=f,d.getElementsByTagName("head")[0].appendChild(a),m.push(a)),n(l[b]);var l=[],g=e.getElementsByTagName("head")[0].getElementsByTagName("script");if(g!==
[])for(b=0;b<g.length;b++)"singulr-ignore"!==g[b].getAttribute("class")&&(f=g[b].getAttribute("src"),a=g[b].innerHTML,null!==f?l.push(["src",f]):""!==a&&l.push(["code",a]),n(g[b]));r(l);g=e.getElementsByTagName("body")[0].getElementsByTagName("script");if(g!==[])for(b=0;b<g.length;b++)"singulr-ignore"!==g[b].getAttribute("class")&&(f=g[b].getAttribute("src"),a=g[b].innerHTML,null!==f?p.push(["src",f]):""!==a&&p.push(["code",a]),n(g[b]));a=h.analyticNodes;if(0<a.length)for(b=0;b<a.length;b++)d.getElementsByTagName("body")[0].appendChild(a[b]),
m.push(a[b]);z();return e.documentElement.getElementsByTagName("body")[0].innerHTML})}function y(a,c,b){function e(){if(200===f.status){var c=b(f.responseText);if("string"===typeof c)d.getElementById(a).innerHTML=c;else if(void 0===c)d.getElementById(a).innerHTML=f.responseText;else throw Error("Invalid callback return!");}else if(404===f.status)q(h.PAGE_404);else throw alert("Error "+f.status+": "+f.statusText),Error("Error status: "+f.status);}var f=new XMLHttpRequest;f.open("GET",c,!0);f.onload=
a===h.CONTENT_ID?function(){e();h.onDocumentLoaded();r(p,function(){p=[];h.onPageLoaded();u()})}:function(){e();r(p,function(){p=[];u()})};f.send()}function C(a,c){var b=d.createElement("script");b.async=!1;b.onload=b.onreadystatechange=function(){c();b.parentNode.removeChild(b)};b.src=a;d.getElementsByTagName("body")[0].appendChild(b)}function r(a,c){0<a.length?w(0,a,c||function(){}):"function"===typeof c&&c()}function w(a,c,b){"src"===c[a][0]?C(c[a][1],function(){void 0!==c[a+1]?w(a+1,c,b):b()}):
"code"===c[a][0]&&(k.eval.call(k,c[a][1]),void 0!==c[a+1]?w(a+1,c,b):b())}function n(a){if(void 0===a||null===a)console.warn("No node provided!");else{if(null===a.parentNode)throw Error("Node has been already removed");t.push(a)}}function z(){for(var a=0;a<t.length;a++){var c=t[a];c.parentNode.removeChild(c)}t=[]}function D(a,c){function b(){!e&&c&&(e=!0,c.call(a))}var e;a.addEventListener&&a.addEventListener("load",b);a.attachEvent&&a.attachEvent("onload",b);if("isApplicationInstalled"in navigator&&
"onloadcssdefined"in a)a.onloadcssdefined(b)}var x="",m=[],t=[],p=[],A=!1,h={onDocumentLoaded:function(){},onPageLoaded:function(){},onDependenciesLoaded:function(){},analyticNodes:[],INDEX_PAGE:"/index.html",INDEX_PATH:"/",HOME_PAGE:"home.html",BASE_PAGE:"base.html",PAGE_404:"404.html",PAGE_ID:"page",CONTENT_ID:"content",dependencies:{javascript:[],css:[]}};k.Singulr={init:function(a){function c(){A||(A=!0,h.onDependenciesLoaded(),y(h.PAGE_ID,h.BASE_PAGE,function(){var a=k.location.href.substr(k.location.href.lastIndexOf("/")+
1),a=a.substr(a.indexOf("?")+1),a=decodeURIComponent(a);k.history.replaceState({},"",a);console.log("curFullPageUrl: "+a);0<a.length&&a!==h.INDEX_PAGE?v(a):q(h.HOME_PAGE)}))}if(void 0!==a)for(var b in a)a.hasOwnProperty(b)&&void 0!==h[b]&&(h[b]=a[b]);B();var e=!1,f=!0;b=[];for(a=0;a<h.dependencies.javascript.length;a++)b.push(["src",h.dependencies.javascript[a]]);r(b,function(){e=!0;f&&c()});b=h.dependencies.css;var d=[],g;for(a=0;a<b.length;a++)g=E(b[a]),D(g,function(){d[a]=!0;for(var a=0;a<d.length;a++)if(!1===
d[a])return;f=!0;e&&c()})},getPage:function(){var a=k.location,c=a.pathname+a.hash+a.search;return a.pathname===h.INDEX_PAGE||a.pathname===h.INDEX_PATH?h.INDEX_PATH+h.HOME_PAGE:c},loadPage:v,bindEventHandlers:c};var E=function(a,c,b){function e(a){if(d.body)return a();setTimeout(function(){e(a)})}function f(){g.addEventListener&&g.removeEventListener("load",f);g.media=b||"all"}var d=k.document,g=d.createElement("link"),h;if(c)h=c;else{var m=(d.body||d.getElementsByTagName("head")[0]).childNodes;h=m[m.length-1]}var p=
d.styleSheets;g.rel="stylesheet";g.href=a;g.media="only x";e(function(){h.parentNode.insertBefore(g,c?h:h.nextSibling)});var n=function(a){for(var b=g.href,c=p.length;c--;)if(p[c].href===b)return a();setTimeout(function(){n(a)})};g.addEventListener&&g.addEventListener("load",f);g.onloadcssdefined=n;n(f);return g}})(document,window);
