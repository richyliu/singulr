/*! Singulr v0.0.1r15 | (c) Richard Liu | MIT License */

(function(d,f){function u(){function b(a){var b=this.getAttribute("href"),c=a.target;1<a.which||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||f.location.protocol!==c.protocol||f.location.hostname!==c.hostname||-1<c.href.indexOf("#")&&c.href.replace(/#.*/,"")==f.location.href.replace(/#.*/,"")||f.location.pathname+f.location.hash+f.location.search===c.pathname+c.hash+c.search||(console.log("click!"),v(b),a.preventDefault())}function c(a){q(d.location.href.substr(d.location.href.lastIndexOf("/")+1))}
for(var a=d.getElementsByTagName("a"),p=0;p<a.length;p++)a[p].removeEventListener("click",b);a=d.getElementsByTagName("a");for(p=0;p<a.length;p++)a[p].addEventListener("click",b);null===f.onpopstate&&(f.onpopstate=c)}function B(){function b(a){"N"==a.animationName&&(console.log("node inserted!"),console.log(a),u())}d.removeEventListener("animationstart",b,!1);d.removeEventListener("MSAnimationStart",b,!1);d.removeEventListener("webkitAnimationStart",b,!1);d.addEventListener("animationstart",b,!1);
d.addEventListener("MSAnimationStart",b,!1);d.addEventListener("webkitAnimationStart",b,!1);var c=d.createElement("style");c.innerHTML="@-webkit-keyframes fLhpiHgvMd{}@-moz-keyframes fLhpiHgvMd{}@-o-keyframes fLhpiHgvMd{}@keyframes fLhpiHgvMd{}a{-webkit-animation-name:fLhpiHgvMd;-moz-animation-name:fLhpiHgvMd;-o-animation-name:fLhpiHgvMd;animation-name:fLhpiHgvMd}";d.getElementsByTagName("head")[0].appendChild(c)}function v(b){console.log("load page external: "+b);f.history.pushState({},"",b);q(b)}
function q(b){x=b;y(h.CONTENT_ID,x,function(c){if(l!==[]){for(var a=0;a<l.length;a++)m(l[a]);z();l=[]}if(!c||"string"!==typeof c)throw"Invalid page";var b=d.implementation.createHTMLDocument();-1<c.search("<html>")?b.body.parentElement.innerHTML=c:b.body.parentElement.innerHTML="<html>"+c+"</html>";var e,a=b.getElementsByTagName("title")[0];null!==a&&""!==a&&(d.title=a.innerHTML);if(b.getElementsByTagName("style")!==[])for(var k=b.getElementsByTagName("style"),a=0;a<k.length;a++)e=k[a].innerHTML,
""!==e&&(c=d.createElement("style"),c.innerHTML=e,d.getElementsByTagName("head")[0].appendChild(c),l.push(c)),m(k[a]);if(b.getElementsByTagName("link")!==[])for(k=b.getElementsByTagName("link"),a=0;a<k.length;a++)"stylesheet"===k[a].getAttribute("rel")&&(e=k[a].getAttribute("href"),c=d.createElement("link"),c.rel="stylesheet",c.type="text/css",c.href=e,d.getElementsByTagName("head")[0].appendChild(c),l.push(c)),m(k[a]);k=[];if(b.getElementsByTagName("head")[0].getElementsByTagName("script")!==[])for(var g=
b.getElementsByTagName("head")[0].getElementsByTagName("script"),a=0;a<g.length;a++)"singulr-ignore"!==g[a].getAttribute("class")&&(e=g[a].getAttribute("src"),c=g[a].innerHTML,null!==e?k.push(["src",e]):""!==c&&k.push(["code",c]),m(g[a]));r(k);if(b.getElementsByTagName("body")[0].getElementsByTagName("script")!==[])for(g=b.getElementsByTagName("body")[0].getElementsByTagName("script"),a=0;a<g.length;a++)"singulr-ignore"!==g[a].getAttribute("class")&&(e=g[a].getAttribute("src"),c=g[a].innerHTML,null!==
e?n.push(["src",e]):""!==c&&n.push(["code",c]),m(g[a]));c=h.analyticNodes;if(0<c.length)for(a=0;a<c.length;a++)d.getElementsByTagName("body")[0].appendChild(c[a]),l.push(c[a]);z();return b.documentElement.getElementsByTagName("body")[0].innerHTML})}function y(b,c,a){function f(){if(200===e.status){var c=a(e.responseText);if("string"===typeof c)d.getElementById(b).innerHTML=c;else if(void 0===c)d.getElementById(b).innerHTML=e.responseText;else throw Error("Invalid callback return!");}else if(404===
e.status)q(h.PAGE_404);else throw alert("Error "+e.status+": "+e.statusText),Error("Error status: "+e.status);}var e=new XMLHttpRequest;e.open("GET",c,!0);e.onload=b===h.CONTENT_ID?function(){f();h.onDocumentLoaded();r(n,function(){n=[];h.onPageLoaded();u()})}:function(){f();r(n,function(){n=[];u()})};e.send()}function C(b,c){var a=d.createElement("script");a.async=!1;a.onload=a.onreadystatechange=function(){c();a.parentNode.removeChild(a)};a.src=b;d.getElementsByTagName("body")[0].appendChild(a)}
function r(b,c){0<b.length?w(0,b,c||function(){}):"function"===typeof c&&c()}function w(b,c,a){"src"===c[b][0]?C(c[b][1],function(){void 0!==c[b+1]?w(b+1,c,a):a()}):"code"===c[b][0]&&(f.eval.call(f,c[b][1]),void 0!==c[b+1]?w(b+1,c,a):a())}function m(b){if(void 0===b||null===b)console.warn("No node provided!");else{if(null===b.parentNode)throw Error("Node has been already removed");t.push(b)}}function z(){for(var b=0;b<t.length;b++){var c=t[b];c.parentNode.removeChild(c)}t=[]}function D(b,c){function a(){!f&&
c&&(f=!0,c.call(b))}var f;b.addEventListener&&b.addEventListener("load",a);b.attachEvent&&b.attachEvent("onload",a);if("isApplicationInstalled"in navigator&&"onloadcssdefined"in b)b.onloadcssdefined(a)}var x="",l=[],t=[],n=[],A=!0,h={onDocumentLoaded:function(){},onPageLoaded:function(){},onDependenciesLoaded:function(){},analyticNodes:[],HOME_PAGE:"home.html",BASE_PAGE:"base.html",PAGE_404:"404.html",PAGE_ID:"page",CONTENT_ID:"content",dependencies:{javascript:[],css:[]}};f.Singulr={init:function(b){function c(){A?
A=!1:(h.onDependenciesLoaded(),y(h.PAGE_ID,h.BASE_PAGE,function(){var a=f.location.href.substr(f.location.href.lastIndexOf("/")+1),a=a.substr(a.indexOf("?")+1),a=decodeURIComponent(a);f.history.replaceState({},"",a);console.log("curFullPageUrl: "+a);0<a.length&&"index.html"!==a?v(a):q(h.HOME_PAGE)}))}if(void 0!==b)for(var a in b)b.hasOwnProperty(a)&&void 0!==h[a]&&(h[a]=b[a]);console.log(h);B();var d=!1,e=!0;a=[];for(b=0;b<h.dependencies.javascript.length;b++)a.push(["src",h.dependencies.javascript[b]]);
r(a,function(){d=!0;e&&c()});a=h.dependencies.css;var k=[],g;for(b=0;b<a.length;b++)g=E(a[b]),D(g,function(){k[a]=!0;for(var a=0;a<k.length;a++)if(!1===k[a])return;e=!0;d&&c()})},getPage:function(){return"index.html"===f.location.pathname.substr(f.location.pathname.lastIndexOf("/")+1)||"/"===f.location.pathname.charAt(f.location.pathname.length-1)?"/"+h.HOME_PAGE:f.location.href.match(/[^\/](\/[\w\%\-\_]+(\.[a-zA-Z]+)?)+.*$/)[0].substr(1)},loadPage:v};var E=function(b,c,a){function d(a){if(k.body)return a();
setTimeout(function(){d(a)})}function e(){g.addEventListener&&g.removeEventListener("load",e);g.media=a||"all"}var k=f.document,g=k.createElement("link"),h;if(c)h=c;else{var l=(k.body||k.getElementsByTagName("head")[0]).childNodes;h=l[l.length-1]}var n=k.styleSheets;g.rel="stylesheet";g.href=b;g.media="only x";d(function(){h.parentNode.insertBefore(g,c?h:h.nextSibling)});var m=function(a){for(var b=g.href,c=n.length;c--;)if(n[c].href===b)return a();setTimeout(function(){m(a)})};g.addEventListener&&
g.addEventListener("load",e);g.onloadcssdefined=m;m(e);return g}})(document,window);
