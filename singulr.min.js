/*! Singulr v0.0.1r7 | (c) Richard Liu | MIT License */

(function(f,k){function A(){function a(){var b=this.getAttribute("href");-1<b.search(/^(?:[a-z]+:)?\/\//i)||b===q||(u(b),event.preventDefault())}function c(b){n(f.location.href.substr(f.location.href.lastIndexOf("/")+1))}for(var d=f.getElementsByTagName("a"),b=0;b<d.length;b++)d[b].removeEventListener("click",a);d=f.getElementsByTagName("a");for(b=0;b<d.length;b++)d[b].addEventListener("click",a);null===k.onpopstate&&(k.onpopstate=c)}function u(a){k.history.pushState({},"",a);n(a)}function n(a){function c(d){if(m!==
[]){for(var b=0;b<m.length;b++)p(m[b]);x();m=[]}A();if(!d||"string"!==typeof d)throw"Invalid page";var a=f.implementation.createHTMLDocument();-1<d.search("<html>")?a.body.parentElement.innerHTML=d:a.body.parentElement.innerHTML="<html>"+d+"</html>";var c,b=a.getElementsByTagName("title")[0];null!==b&&""!==b&&(f.title=b.innerHTML);if(a.getElementsByTagName("style")!==[])for(var e=a.getElementsByTagName("style"),b=0;b<e.length;b++)c=e[b].innerHTML,""!==c&&(d=f.createElement("style"),d.innerHTML=c,
f.getElementsByTagName("head")[0].appendChild(d),m.push(d)),p(e[b]);if(a.getElementsByTagName("link")!==[])for(e=a.getElementsByTagName("link"),b=0;b<e.length;b++)"stylesheet"===e[b].getAttribute("rel")&&(c=e[b].getAttribute("href"),d=f.createElement("link"),d.rel="stylesheet",d.type="text/css",d.href=c,f.getElementsByTagName("head")[0].appendChild(d),m.push(d)),p(e[b]);e=[];if(a.getElementsByTagName("head")[0].getElementsByTagName("script")!==[])for(var h=a.getElementsByTagName("head")[0].getElementsByTagName("script"),
b=0;b<h.length;b++)"singulr-ignore"!==h[b].getAttribute("id")&&(c=h[b].getAttribute("src"),d=h[b].innerHTML,null!==c?e.push(["src",c]):""!==d&&e.push(["code",d]),p(h[b]));v(e);if(a.getElementsByTagName("body")[0].getElementsByTagName("script")!==[])for(h=a.getElementsByTagName("body")[0].getElementsByTagName("script"),b=0;b<h.length;b++)"singulr-ignore"!==h[b].getAttribute("id")&&(c=h[b].getAttribute("src"),d=h[b].innerHTML,null!==c?r.push(["src",c]):""!==d&&r.push(["code",d]),p(h[b]));d=g.analyticNodes;
if(0<d.length)for(b=0;b<d.length;b++)f.getElementsByTagName("body")[0].appendChild(d[b]),m.push(d[b]);x();return a.documentElement.getElementsByTagName("body")[0].innerHTML}q=a;try{y(g.CONTENT_ID,q,c)}catch(d){console.error(d),n(g.PAGE_404)}}function y(a,c,d){var b=new XMLHttpRequest;b.open("GET",c,!0);b.onreadystatechange=function(){if(4===b.readyState&&200===b.status){var c=d(b.responseText);if("string"===typeof c)f.getElementById(a).innerHTML=c;else if(void 0===c)f.getElementById(a).innerHTML=
b.responseText;else throw Error("Invalid callback return!");g.onDocumentLoaded()}else 404===b.status&&n(g.PAGE_404);v(r);r=[];g.onPageLoaded()};b.send()}function B(a,c){var d=f.createElement("script");d.async=1;d.onload=d.onreadystatechange=function(){c();d.parentNode.removeChild(d)};d.src=a;f.getElementsByTagName("body")[0].appendChild(d)}function v(a,c){0!==a.length&&(c=c||function(){},console.log(a),l=[],l=a,w(0,c))}function w(a,c){"src"===l[a][0]?B(l[a][1],function(){void 0!==l[a+1]?w(a+1,c):
c()}):"code"===l[a][0]&&(k.eval.call(k,l[a][1]),void 0!==l[a+1]?w(a+1,c):c())}function p(a){if(void 0===a||null===a)console.warn("No node provided!");else{if(null===a.parentNode)throw Error("Node has been already removed");t.push(a)}}function x(){for(var a=0;a<t.length;a++){var c=t[a];c.parentNode.removeChild(c)}t=[]}function z(){if(k.location.href.lastIndexOf("/")===k.location.href.length-1)return g.HOME_PAGE;var a=k.location.href;console.log("full url: "+a);return a.match(/[^\/](\/[\w\%\-\_]+(\.[a-zA-Z]+)?)+(?:(?=\#|\?)|$)/)[0].substr(1)}
function C(a,c){function d(){!b&&c&&(b=!0,c.call(a))}var b;a.addEventListener&&a.addEventListener("load",d);a.attachEvent&&a.attachEvent("onload",d);if("isApplicationInstalled"in navigator&&"onloadcssdefined"in a)a.onloadcssdefined(d)}var q="",m=[],t=[],r=[],l=[],g={onDocumentLoaded:function(){},onPageLoaded:function(){},onDependenciesLoaded:function(){},analyticNodes:[],HOME_PAGE:"home.html",BASE_PAGE:"base.html",PAGE_404:"404.html",PAGE_ID:"page",CONTENT_ID:"content",dependencies:{javascript:[],
css:[]}};String.prototype.allIndexOf=function(a){for(var c=[],d=0;d<this.length;d++)this[d]===a&&c.push(d);return c};k.Singulr={init:function(a){if(void 0!==a)for(var c in a)a.hasOwnProperty(c)&&void 0!==g[c]&&(g[c]=a[c]);a=[];for(c=0;c<g.dependencies.javascript.length;c++)a.push(["src",g.dependencies.javascript[c]]);v(a,function(){var a=g.dependencies.css,b=[];console.log(b);for(var c,f=0;f<a.length;f++)c=D(a[f]),C(c,function(){b[a]=!0;for(var a=0;a<b.length;a++)if(!1===b[a])return;g.onDependenciesLoaded();
y(g.PAGE_ID,g.BASE_PAGE,function(){var a=k.location.href.substr(k.location.href.lastIndexOf("/")+1),a=a.substr(a.indexOf("?")+1),a=decodeURIComponent(a);k.history.replaceState({},"",a);0<a.length&&z()!==q?u(a):n(g.HOME_PAGE)})})})},getPage:z,loadPage:u};var D=function(a,c,d){function b(a){if(g.body)return a();setTimeout(function(){b(a)})}function f(){e.addEventListener&&e.removeEventListener("load",f);e.media=d||"all"}var g=k.document,e=g.createElement("link"),h;if(c)h=c;else{var l=(g.body||g.getElementsByTagName("head")[0]).childNodes;
h=l[l.length-1]}var m=g.styleSheets;e.rel="stylesheet";e.href=a;e.media="only x";b(function(){h.parentNode.insertBefore(e,c?h:h.nextSibling)});var n=function(a){for(var b=e.href,c=m.length;c--;)if(m[c].href===b)return a();setTimeout(function(){n(a)})};e.addEventListener&&e.addEventListener("load",f);e.onloadcssdefined=n;n(f);return e}})(document,window);
